<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">

    <!-- MUY IMPORTANTE PARA iPad -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Señor Chilaquil - Sistema Ventas</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pos.css') }}">

    <style>
        body { margin: 0; }
        .flash { padding: 8px; margin: 5px 0; border-radius: 4px; }
        .success { background: #c8e6c9; }
        .error { background: #ffcdd2; }
    </style>
</head>
<body>

<nav class="navbar">
  <div class="nav-left">
    <a class="brand" href="{{ url_for('index') }}">Señor Chilaquil</a>
  </div>

  <div class="nav-links">

    <div class="nav-dd">
      <button class="nav-dd-btn" type="button">
        POS <span class="nav-caret">▾</span>
      </button>
      <div class="nav-dd-menu">
        <a href="{{ url_for('nuevo_pedido') }}">Nuevo pedido</a>
        <a href="{{ url_for('pedidos_abiertos') }}">Pedidos abiertos</a>
      </div>
    </div>

    <div class="nav-dd">
      <button class="nav-dd-btn" type="button">
        Catálogos <span class="nav-caret">▾</span>
      </button>
      <div class="nav-dd-menu">
        <a href="{{ url_for('productos') }}">Productos</a>
      </div>
    </div>

    <div class="nav-dd">
      <button class="nav-dd-btn" type="button">
        Inventario <span class="nav-caret">▾</span>
      </button>
      <div class="nav-dd-menu">
        <a href="{{ url_for('ver_stock') }}">Stock actual</a>
        <a href="{{ url_for('compras') }}">Compras</a>
      </div>
    </div>

    <div class="nav-dd">
      <button class="nav-dd-btn" type="button">
        Admin <span class="nav-caret">▾</span>
      </button>
      <div class="nav-dd-menu">
        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        <a href="{{ url_for('borrar_pedidos') }}">Borrar pedidos</a>
      </div>
    </div>

  </div>
</nav>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% block content %}{% endblock %}

<script>
document.addEventListener("DOMContentLoaded", () => {
  const dds = document.querySelectorAll(".nav-dd");
  const buttons = document.querySelectorAll(".nav-dd-btn");

  function closeAll(except = null){
    dds.forEach(dd => {
      if (dd !== except) dd.classList.remove("is-open");
    });
  }

  function toggle(dd){
    const willOpen = !dd.classList.contains("is-open");
    closeAll(dd);
    dd.classList.toggle("is-open", willOpen);
  }

  buttons.forEach(btn => {
    const handler = (e) => {
      e.preventDefault();
      e.stopPropagation();
      const dd = btn.closest(".nav-dd");
      if (!dd) return;
      toggle(dd);
    };

    btn.addEventListener("pointerdown", handler);
    btn.addEventListener("click", handler);
  });

  document.addEventListener("pointerdown", () => closeAll());
  document.addEventListener("click", () => closeAll());

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeAll();
  });
});
</script>

</body>
</html>
