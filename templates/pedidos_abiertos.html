{% extends "base.html" %}

{% block content %}

<div class="app-header">
    <div>ğŸ“‹ Pedidos abiertos</div>
    <div>{{ pedidos|length if pedidos else 0 }} activos</div>
</div>

<div class="panel">

{% if pedidos %}
<div style="display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:16px;">

    {% for p in pedidos %}
    <div class="card">

        <strong>Pedido #{{ p.id }}</strong><br>

        <small>
            ğŸ“… {{ p.fecha }}
        </small><br><br>

        {% if p.mesa %}
            Mesa: {{ p.mesa }}<br>
        {% endif %}

        Mesero: {{ p.mesero or '-' }}<br>
        Total: <strong>{{ p.total | money }}</strong><br>

        <!-- ================= PREVIEW ITEMS ================= -->
        {% if p.items_preview %}
        <div style="margin:8px 0; font-size:14px; color:#444;">
            <strong>Items:</strong>
            <ul style="padding-left:16px; margin:4px 0;">
                {% for it in p.items_preview %}
                <li>{{ it.cantidad }} Ã— {{ it.nombre }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- ================= ACCIONES ================= -->
        <a href="{{ url_for('ver_pedido', pedido_id=p.id) }}"
           class="btn btn-primary"
           style="display:block; text-align:center; margin-bottom:6px;">
            â• Entrar al pedido
        </a>

        <form method="post"
              action="{{ url_for('cerrar_pedido', pedido_id=p.id) }}"
              style="margin-bottom:6px;">
            <button type="submit"
                    class="btn btn-warning"
                    style="width:100%;">
                Cerrar pedido
            </button>
        </form>

        <form method="post"
              action="{{ url_for('eliminar_pedido', pedido_id=p.id) }}"
              onsubmit="return confirm('Â¿Eliminar este pedido?')">
            <button type="submit"
                    class="btn btn-danger"
                    style="width:100%;">
                ğŸ—‘ï¸ Eliminar pedido
            </button>
        </form>

    </div>
    {% endfor %}

</div>
{% else %}
<p>No hay pedidos abiertos.</p>
{% endif %}

</div>

{% endblock %}
