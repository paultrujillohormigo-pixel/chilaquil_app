{% extends "base.html" %}
{% block content %}

<h2>Nuevo pedido</h2>

<form method="post" id="pedidoForm">

    <!-- ================== DATOS GENERALES ================== -->
    <label>Fecha del pedido:</label>
    <input type="datetime-local" name="fecha">
    <small>Déjalo vacío para usar la fecha actual</small>
    <br><br>

    <label>Origen:</label>
    <select name="origen">
        <option value="mostrador">Mostrador</option>
        <option value="uber">Uber</option>
        <option value="didi">Didi</option>
        <option value="otro">Otro</option>
    </select>

    <label>Mesero:</label>
    <input type="text" name="mesero">

    <label>Método de pago:</label>
    <select name="metodo_pago">
        <option value="efectivo">Efectivo</option>
        <option value="tarjeta">Tarjeta</option>
        <option value="transfer">Transfer</option>
        <option value="otro">Otro</option>
    </select>

    <label>Monto Uber (usa negativo para comisión):</label>
    <input type="number" name="monto_uber" step="0.01" value="0">

    <hr>

    <!-- ================== PRODUCTOS ================== -->
    <h3>Productos</h3>

    <div class="productos-grid">
        {% for p in productos %}
        <div class="producto-card"
             onclick="agregarProducto('{{ p.id }}', '{{ p.nombre }}', {{ p.precio }})">
            <strong>{{ p.nombre }}</strong>
            <div>{{ p.categoria }}</div>
            <div class="precio">${{ p.precio }}</div>
        </div>
        {% endfor %}
    </div>

    <hr>

    <!-- ================== CARRITO ================== -->
    <h3>Carrito</h3>

    <table id="carritoTable">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>Precio</th>
                <th>Subtotal</th>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h3>Total del Pedido: <span id="totalPedido">$0.00</span></h3>

    <!-- Inputs ocultos -->
    <div id="inputsHidden"></div>

    <button type="submit">Guardar pedido</button>
</form>

<!-- ================== ESTILOS ================== -->
<style>
.productos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 12px;
}

.producto-card {
    border: 1px solid #ccc;
    padding: 12px;
    border-radius: 8px;
    cursor: pointer;
    background: #fafafa;
    transition: 0.2s;
    text-align: center;
}

.producto-card:hover {
    background: #f0f0f0;
    transform: scale(1.03);
}

#carritoTable {
    width: 100%;
    border-collapse: collapse;
}

#carritoTable th,
#carritoTable td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
}

.btn {
    padding: 4px 8px;
    cursor: pointer;
}

.btn-red {
    background: #e74c3c;
    color: white;
    border: none;
}

.btn-gray {
    background: #ddd;
    border: none;
}
</style>

<!-- ================== SCRIPT ================== -->
<script>
let carrito = {};

// ➕ Agregar producto
function agregarProducto(id, nombre, precio) {
    if (!carrito[id]) {
        carrito[id] = {
            nombre,
            precio,
            cantidad: 1
        };
    } else {
        carrito[id].cantidad += 1;
    }
    renderCarrito();
}

// ➖ Restar producto
function restarProducto(id) {
    if (!carrito[id]) return;

    carrito[id].can
