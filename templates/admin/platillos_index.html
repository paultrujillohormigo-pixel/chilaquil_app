{% extends "base.html" %}
{% block content %}

<div class="page-head">
  <h2>üçΩÔ∏è Platillos</h2>
  <div class="page-actions">
    <a class="btn btn-secondary" href="{{ url_for('costeo.insumos_index') }}">üßæ Insumos</a>
    <a class="btn btn-secondary" href="{{ url_for('costeo.recetas_index') }}">üìå Recetas</a>
    <a class="btn btn-secondary" href="{{ url_for('costeo.costeo_index') }}">üìä Costeo</a>
  </div>
</div>

<div class="card">
  <div class="card-head">
    <h3>Agregar platillo</h3>
    <p class="muted">Primero crea tus platillos. Luego podr√°s asignarles receta.</p>
  </div>

  <form method="post" action="{{ url_for('costeo.platillos_create') }}" class="form-grid">
    <div>
      <label>Nombre</label>
      <input type="text" name="nombre" placeholder="Ej. Chilaquiles" required>
    </div>

    <div>
      <label>Precio actual (opcional)</label>
      <input type="number" step="0.01" min="0" name="precio_actual" placeholder="Ej. 180">
      <small class="muted" style="display:block; margin-top:6px;">
        Se guarda en <b>platillos.precio_actual</b> y tambi√©n lo usaremos para actualizar el POS.
      </small>
    </div>

    <div class="form-actions">
      <button class="btn btn-primary" type="submit">Guardar</button>
    </div>
  </form>
</div>

<div class="card" style="margin-top:16px;">
  <div class="card-head">
    <h3>Lista</h3>
    <p class="muted" style="margin-top:6px;">
      Puedes actualizar el precio aqu√≠. Esto debe actualizar <b>platillos.precio_actual</b> y <b>productos.precio</b> (POS).
    </p>
  </div>

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th style="width:80px;">ID</th>
          <th>Platillo</th>
          <th style="width:260px;">Precio (actualizar)</th>
          <th style="width:220px;">Acci√≥n</th>
        </tr>
      </thead>
      <tbody>
        {% for p in platillos %}
        <tr>
          <td>{{ p.id }}</td>
          <td><strong>{{ p.nombre }}</strong></td>

          <td>
            <form method="post"
                  action="{{ url_for('costeo.platillo_precio_update', platillo_id=p.id) }}"
                  style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
              <div style="min-width:90px;">
                {% if p.precio_actual %}
                  <strong>${{ "%.2f"|format(p.precio_actual) }}</strong>
                {% else %}
                  <span class="muted">‚Äî</span>
                {% endif %}
              </div>

              <input type="number" step="0.01" min="0" name="precio_pos" required
                     value="{% if p.precio_actual %}{{ "%.2f"|format(p.precio_actual) }}{% endif %}"
                     placeholder="Ej. 180"
                     style="width:140px; padding:8px 10px; border:1px solid #ddd; border-radius:10px;">

              <button class="btn btn-primary" type="submit" style="padding:8px 10px;">
                Actualizar
              </button>
            </form>

            <small class="muted" style="display:block; margin-top:6px;">
              Nota: requiere que exista un producto ligado con <b>productos.platillo_id={{ p.id }}</b>.
            </small>
          </td>

          <td>
            <a class="btn btn-secondary" href="{{ url_for('costeo.recetas_edit', platillo_id=p.id) }}">
              ‚úèÔ∏è Crear/Editar receta
            </a>
          </td>
        </tr>
        {% endfor %}

        {% if not platillos %}
        <tr>
          <td colspan="4" class="muted">No hay platillos todav√≠a. Agrega el primero arriba.</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<style>
  .page-head{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;margin-bottom:16px}
  .page-actions{display:flex;gap:10px;flex-wrap:wrap}
  .card{background:#fff;border:1px solid #e7e7e7;border-radius:14px;padding:16px}
  .card-head h3{margin:0 0 6px 0}
  .muted{opacity:.7;margin:0}
  .table-wrap{overflow:auto;margin-top:10px}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{padding:12px;border-bottom:1px solid #eee;text-align:left;vertical-align:middle;white-space:nowrap}
  .form-grid{display:grid;grid-template-columns:1fr 220px;gap:12px;align-items:end}
  label{display:block;font-weight:600;margin-bottom:6px}
  input{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:10px}
  .form-actions{display:flex;justify-content:flex-end}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;text-decoration:none;border:1px solid #ddd;cursor:pointer}
  .btn-primary{background:#111;color:#fff;border-color:#111}
  .btn-secondary{background:#f6f6f6;color:#111}
</style>

{% endblock %}
