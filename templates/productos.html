{% extends "base.html" %}
{% block content %}
<h2 class="pos-title">ðŸ“¦ Productos</h2>

<div class="pos-layout" style="gap:12px;">
  <section class="pos-left">

    <div class="card">
      <div class="card-head">
        <h3>Agregar producto</h3>
      </div>

      <form method="post" class="form-grid">

        <div>
          <label>Nombre</label>
          <input type="text" name="nombre" required>
        </div>

        <div>
          <label>CategorÃ­a</label>
          <input type="text" name="categoria" placeholder="chilaquiles, tortas, bebidas..." required>
        </div>

        <div>
          <label>Costo</label>
          <input type="number" name="costo" step="0.01" min="0" required>
        </div>

        <div>
          <label>Precio</label>
          <input type="number" name="precio" step="0.01" min="0" required>
        </div>

        <div style="grid-column: 1 / -1;">
          <label>Platillo (receta)</label>
          <select name="platillo_id">
            <option value="">â€” Sin receta (no descuenta stock) â€”</option>
            {% for pl in platillos %}
              <option value="{{ pl.id }}">{{ pl.nombre }}</option>
            {% endfor %}
          </select>
          <small class="hint">Si lo dejas vacÃ­o, este producto NO podrÃ¡ descontar inventario.</small>
        </div>

        <div style="grid-column: 1 / -1; display:flex; justify-content:flex-end;">
          <button type="submit" class="btn-primary">âž• Agregar</button>
        </div>

      </form>
    </div>

    <div class="card">
      <div class="card-head">
        <h3>Lista de productos</h3>
        <div class="hint">Relaciona cada producto con su platillo/receta</div>
      </div>

      <div style="overflow:auto;">
        <table class="pedido-table">
          <thead>
            <tr>
              <th style="width:60px;">ID</th>
              <th>Nombre</th>
              <th style="width:140px;">CategorÃ­a</th>
              <th style="width:110px;">Costo</th>
              <th style="width:110px;">Precio</th>
              <th style="width:260px;">Platillo (receta)</th>
              <th style="width:120px;"></th>
            </tr>
          </thead>
          <tbody>
            {% for p in productos %}
            <tr>
              <td>{{ p.id }}</td>
              <td class="td-left">{{ p.nombre }}</td>
              <td>{{ p.categoria }}</td>
              <td>{{ p.costo | money }}</td>
              <td><strong>{{ p.precio | money }}</strong></td>

              <td>
                <form method="post" action="{{ url_for('productos_set_platillo', producto_id=p.id) }}" style="display:flex; gap:8px; align-items:center;">
                  <select name="platillo_id" style="flex:1;">
                    <option value="">â€” Sin receta â€”</option>
                    {% for pl in platillos %}
                      <option value="{{ pl.id }}" {% if p.platillo_id == pl.id %}selected{% endif %}>
                        {{ pl.nombre }}
                      </option>
                    {% endfor %}
                  </select>
              </td>

              <td>
                  <button type="submit" class="btn-gray">Guardar</button>
                </form>
              </td>

            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>

  </section>
</div>

<style>
.pedido-table{ width:100%; table-layout:fixed; border-collapse:collapse; }
.pedido-table th,.pedido-table td{ padding:10px; border-bottom:1px solid #eee; vertical-align:top; }
.td-left{ white-space:normal; overflow-wrap:anywhere; word-break:break-word; }
</style>

{% endblock %}
