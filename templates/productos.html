{% extends "base.html" %}
{% block content %}
<h2>Productos</h2>

<form method="post" style="display:grid; gap:10px; max-width:900px; margin-bottom:18px;">
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <div>
            <label>Nombre:</label>
            <input type="text" name="nombre" required style="width:100%;">
        </div>

        <div>
            <label>Categoría:</label>
            <input type="text" name="categoria" placeholder="chilaquiles, tamal, bebida..." required style="width:100%;">
        </div>

        <div>
            <label>Costo:</label>
            <input type="number" name="costo" step="0.01" required style="width:100%;">
        </div>

        <div>
            <label>Precio:</label>
            <input type="number" name="precio" step="0.01" required style="width:100%;">
        </div>

        <div style="grid-column: 1 / -1;">
            <label>Platillo (para receta / descuento inventario):</label>
            <select name="platillo_id" style="width:100%;">
                <option value="">— Sin platillo (no descuenta inventario) —</option>
                {% for pl in platillos %}
                    <option value="{{ pl.id }}">{{ pl.nombre }}</option>
                {% endfor %}
            </select>
            <small style="opacity:.7;">
                Si lo relacionas, al cerrar pedido se puede descontar stock usando recetas/recetas_proteina (vía productos.platillo_id).
            </small>
        </div>
    </div>

    <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button type="submit">Agregar</button>
    </div>
</form>

<table border="1" cellpadding="8" cellspacing="0" style="width:100%; border-collapse:collapse;">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>Costo</th>
            <th>Precio</th>
            <th>Platillo ligado</th>
        </tr>
    </thead>
    <tbody>
        {% for p in productos %}
        <tr>
            <td>{{ p.id }}</td>
            <td>{{ p.nombre }}</td>
            <td>{{ p.categoria }}</td>
            <td>{{ p.costo }}</td>
            <td>{{ p.precio }}</td>
            <td>
                {% if p.platillo_id %}
                    {{ p.platillo_nombre }} <small style="opacity:.7;">(#{{ p.platillo_id }})</small>
                {% else %}
                    <span style="opacity:.6;">—</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
